#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

msg_file="$1"
msg="$(head -n1 "$msg_file" | tr -d '\r')"

# Conventional Commits pattern:
# type(scope)?: summary
# Allowed types: feat|fix|chore|docs|style|refactor|perf|test|build|ci|revert|release
pattern='^(feat|fix|chore|docs|style|refactor|perf|test|build|ci|revert|release)(\([^)]+\))?(!)?: .+'

# Allow merge/revert messages
case "$msg" in
  "Merge branch"*) exit 0 ;;
  "Revert \""*) exit 0 ;;
esac

if printf '%s' "$msg" | grep -Eq "$pattern"; then
  printf '✅ Conventional commit OK: %s\n' "$msg"
  exit 0
else
  echo "❌ Invalid commit message."
  echo "   Example: feat(ui): add barcode error banner"
  echo "   Pattern: type(scope)?: summary"
  echo "   Types: feat|fix|chore|docs|style|refactor|perf|test|build|ci|revert|release"
  echo "   To bypass (not recommended): git commit --no-verify"
  exit 1
fi